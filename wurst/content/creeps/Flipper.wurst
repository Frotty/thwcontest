package Flipper
import Creep
import Hero
import ClosureTimers

trigger range_t

public class Flipper extends Creep
	boolean flipped
	trigger range_trigger
	

	construct(vec3 pos, int id, angle a, vec2 target)
		super( pos, id, a, target)
		flipped = false
		range_trigger = CreateTrigger()
		range_trigger.registerUnitInRangeSource(actor,80, null)
		range_trigger.addAction(function onFlipperRange)
		
	function onInRange(unit target)
		Entity e = target.getEntity()
		if e instanceof Hero and not flipped
			flipped = true
			actor.setAnimation("Spell Slam")
			doAfter(.3,()-> begin
				if actor.isAlive() and (getPos2().distToVec(e.getPos2()) < 100)
					let angl = e.getPos2().angleTo(getPos2())
					let speed = 64
					e.applyVel(vec3(angl.cos() * speed,angl.sin() * speed, speed*1.4))
				else
					flipped = false
			end)
			
	static function onFlipperRange()
		unit source = GetTriggeringTrigger().getSource()
		unit u = GetTriggerUnit()
		Flipper f = source.getEntity() castTo Flipper
		f.onInRange(u)
		
